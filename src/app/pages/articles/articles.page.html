<div class="container">
  <!-- Optional page header (purely visual) -->
  <div class="section-head">
    <h1>Articles</h1>
    
  </div>

  <mat-card>
    
    <mat-card-content>
      <!-- Filter -->
      <div class="toolbar">
        <mat-form-field appearance="outline" class="filter">
          <mat-label>Filter by title/author/tag</mat-label>
          <input matInput (keyup)="applyFilter($event)" placeholder="Type to filter" />
        </mat-form-field>

         <span class="spacer"></span>

        <button mat-stroked-button (click)="downloadCsv()">
          <mat-icon style="margin-right:6px">download</mat-icon>
          Download CSV
        </button>
      </div>
      

      <!-- Loading / Error -->
      <mat-progress-bar *ngIf="svc.loading()" mode="indeterminate"></mat-progress-bar>

      <mat-card *ngIf="svc.error()" class="error-card">
        <mat-card-content>
          <mat-icon style="vertical-align:middle;margin-right:6px;">error</mat-icon>
          {{ svc.error() }}
        </mat-card-content>
      </mat-card>

      <div class="table-wrap" *ngIf="ds.data.length > 0">
        <!-- MATERIAL TABLE (unchanged) -->
        <table *ngIf="ds.data.length > 0"
               mat-table
               [dataSource]="ds"
               matSort
               class="mat-elevation-z1 data-table">

          <!-- ID -->
          <ng-container matColumnDef="id">
            <th mat-header-cell *matHeaderCellDef mat-sort-header class="col-id">ID</th>
            <td mat-cell *matCellDef="let r" class="col-id">{{ r.id }}</td>
          </ng-container>

          <!-- Title -->
          <ng-container matColumnDef="title">
            <th mat-header-cell *matHeaderCellDef mat-sort-header class="col-title">Title</th>
            <td mat-cell *matCellDef="let r" class="col-title">{{ r.title }}</td>
          </ng-container>

          <!-- Content -->
          <ng-container matColumnDef="content">
            <th mat-header-cell *matHeaderCellDef class="col-content">Content</th>
            <td mat-cell *matCellDef="let r" class="col-content multiline-2">{{ r.content }}</td>
          </ng-container>

          <!-- Author -->
          <ng-container matColumnDef="author">
            <th mat-header-cell *matHeaderCellDef mat-sort-header class="col-author">Author</th>
            <td mat-cell *matCellDef="let r" class="col-author">{{ r.author }}</td>
          </ng-container>

          <!-- Published Date -->
          <ng-container matColumnDef="publishedDate">
            <th mat-header-cell *matHeaderCellDef mat-sort-header class="col-date">Published Date</th>
            <td mat-cell *matCellDef="let r" class="col-date">{{ r.publishedDate | date:'medium' }}</td>
          </ng-container>

          <!-- Category -->
          <ng-container matColumnDef="category">
            <th mat-header-cell *matHeaderCellDef mat-sort-header class="col-category">Category</th>
            <td mat-cell *matCellDef="let r" class="col-category">{{ r.category }}</td>
          </ng-container>

          <!-- Featured -->
          <ng-container matColumnDef="isFeatured">
            <th mat-header-cell *matHeaderCellDef class="col-featured">Featured</th>
            <td mat-cell *matCellDef="let r" class="col-featured center">
              {{ r.isFeatured }}
            </td>
          </ng-container>

          <!-- Read Time -->
          <ng-container matColumnDef="readTimeMinutes">
            <th mat-header-cell *matHeaderCellDef mat-sort-header class="col-read right">Read Time (min)</th>
            <td mat-cell *matCellDef="let r" class="col-read right">{{ r.readTimeMinutes }}</td>
          </ng-container>

          <!-- Image -->
          <ng-container matColumnDef="imageUrl">
            <th mat-header-cell *matHeaderCellDef class="col-image center">Image</th>
            <td mat-cell *matCellDef="let r" class="col-image center">
              <img *ngIf="r.imageUrl" [src]="r.imageUrl" alt="image" class="thumb" />
            </td>
          </ng-container>

          <!-- Likes -->
          <ng-container matColumnDef="likesCount">
            <th mat-header-cell *matHeaderCellDef mat-sort-header class="col-likes right">Likes</th>
            <td mat-cell *matCellDef="let r" class="col-likes right">{{ r.likesCount }}</td>
          </ng-container>

          <!-- Comments -->
          <ng-container matColumnDef="commentsCount">
            <th mat-header-cell *matHeaderCellDef mat-sort-header class="col-comments right">Comments</th>
            <td mat-cell *matCellDef="let r" class="col-comments right">{{ r.commentsCount }}</td>
          </ng-container>

          <!-- Tags -->
<ng-container matColumnDef="tags">
  <th mat-header-cell *matHeaderCellDef class="col-tags">Tags</th>
  <td mat-cell *matCellDef="let r" class="col-tags">
    <mat-chip-set *ngIf="r.tags?.length" class="chips tags-wrap" aria-label="Tags">
      <mat-chip *ngFor="let t of r.tags" class="tag-chip" disableRipple>
        {{ t }}
      </mat-chip>
    </mat-chip-set>
    <span *ngIf="!r.tags?.length" class="muted">—</span>
  </td>
</ng-container>


          <!-- Published -->
          <ng-container matColumnDef="isPublished">
            <th mat-header-cell *matHeaderCellDef class="col-published center">Published</th>
            <td mat-cell *matCellDef="let r" class="col-published center">
              <mat-icon [matTooltip]="r.isPublished ? 'Published' : 'Unpublished'">
                {{ r.isPublished ? 'check_circle' : 'cancel' }}
              </mat-icon>
            </td>
          </ng-container>

          <!-- Last Modified -->
          <ng-container matColumnDef="lastModified">
            <th mat-header-cell *matHeaderCellDef mat-sort-header class="col-modified">Last Modified</th>
            <td mat-cell *matCellDef="let r" class="col-modified">{{ r.lastModified | date:'medium' }}</td>
          </ng-container>

          <!-- Summary -->
          <ng-container matColumnDef="summary">
            <th mat-header-cell *matHeaderCellDef class="col-summary">Summary</th>
            <td mat-cell *matCellDef="let r" class="col-summary multiline-2">{{ r.summary }}</td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="cols"></tr>
          <tr mat-row *matRowDef="let row; columns: cols;"></tr>

          <tr class="mat-row" *matNoDataRow>
            <td class="mat-cell" [attr.colspan]="cols.length">No data to display.</td>
          </tr>
        </table>
      </div>

      <!-- fallback -->
      <div *ngIf="!ds.data.length && !svc.loading()">
        <ul>
          <li *ngFor="let a of svc.articles() ?? []">
            {{ a.title }} — {{ a.author }}
          </li>
        </ul>
      </div>

      <mat-paginator [pageSize]="5" [pageSizeOptions]="[5,10,20]"></mat-paginator>
    </mat-card-content>
  </mat-card>
</div>
